---
title: "z检验方法介绍"
output:
  github_document:
    pandoc_args: --webtex
    html_preview: true
    toc: true
    toc_depth: 3
---

# 功能和使用场景

z检验是假设检验的一种，用于验证样本均值是否与总体的平均水平存在显著性差异。

## 使用场景：

* 样本容量应不小于30，否则使用t检验；

* 观测点彼此独立；

* 样本的抽取方式是平均分布的，即总体中的每个观测被抽取的概率是相等的；

* 不同样本组间的样本数量基本一致；

## 计算流程

1. 定义零假设 $H_0$；

1. 定义备择假设 $H_1$；

1. 定义 $\alpha$ 值：默认值为0.05；

1. 确定 $\alpha$ 值对应的 z-score：$z_0$；

1. 计算样本的 z-score：见式(1)；

1. 得到结论：若 $|z| \gt z_0$，证明基于零假设出现了小概率事件，即零假设不成立，备择假设成立，否则表明现有样本数据无法证明零假设不成立。

单样本 z-score 计算公式：

$$ z = \frac{\bar x - \mu_0}{\sigma / \sqrt n} \tag{1}$$

其中 $\bar x$ 是样本均值，$\mu_0$ 是总体均值，$\sigma$ 是总体方差，$n$ 是样本容量。

双样本 z-score 计算公式：

$$
z = \frac{(\bar X_1 - \bar X_2) - (\mu_1-\mu_2)}{\sqrt{\frac{\sigma_1^2}{n_1} + \frac{\sigma_2^2}{n_2}}}
$$

# 实例分析

## 单样本z检验

某地区学生IQ测试平均成绩为100分，方差15。其中一所学校称本校学生平均IQ成绩高于地区平均水平，为了证明这一点，随机抽取了30个学生参加IQ测试，平均成绩112分。问：测试结果是否表明该校学生平均成绩高于地区平均水平？

1. 定义零假设：$H_0: \; \mu = 100$

1. 定义备择假设：$H_1: \; \mu \gt 100$

1. 定义 $\alpha$ 值：这里取 0.05；

1. 确定 $\alpha$ 值对应的 z-score：$z_0 = 1.645$；

1. 计算样本的 z-score：
```{r}
z <- (112 - 100) / (15 / sqrt(30)); z
```

1. $|z| \gt z_0$，表明在一次实验中出现了小概率事件（概率小于 $\alpha$），表明零假设不合理。
所以此学校学生测试成绩确实高于地区平均成绩。


## 双样本z检验

一种新镇静剂宣称可以降低病人的妄想倾向，其双盲对比实验结果如下：
药物组包含900个病人，妄想测试得分平均9.78，方差4.05，对照组包含1000个病人，测试得分平均15.10,方差4.28。问：从双盲对照测试结果，是否可以证明该镇静剂能够降低病人的妄想倾向？

1. 定义零假设：$H_0: \; \mu_1 = \mu_2$

1. 定义备择假设：$H_1: \; \mu_1 \ne \mu_2$

1. 定义 $\alpha$ 值：这里取 0.05；

1. 确定 $\alpha$ 值对应的 z-score：$z_0 = 1.645$；

1. 计算样本的 z-score：
```{r}
z <- (9.78 - 15.10 - 0) / sqrt(4.05 ^ 2 / 900 + 4.28 ^ 2 / 1000); z
```

1. $|z| \gt z_0$，表明基于零假设 $\mu_1 = \mu_2$ 出现了小概率事件，即该药物确实降低了病人的妄想倾向（这里 $z$ 的负值表示药物组的测试结果低于对照组的测试结果）。